<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Quiz Game</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; }
        .container { max-width: 500px; margin: 40px auto; background: #fff; padding: 32px; border-radius: 8px; box-shadow: 0 2px 8px #0001; }
        .question { font-size: 1.2em; margin-bottom: 16px; }
        .options { margin-bottom: 16px; }
        .options label { display: block; margin-bottom: 8px; }
        .score { font-weight: bold; margin-top: 16px; }
        button { background: #4CAF50; color: #fff; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        button:disabled { background: #aaa; }
        .hidden { display: none; }
        .error { color: #c00; margin-bottom: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h2>Quiz Game'e Hoş Geldiniz!</h2>
    <div id="login-area">
        <div class="error" id="login-error"></div>
        <input type="text" id="username" placeholder="Kullanıcı adı" style="width:100%;padding:8px;margin-bottom:10px;">
        <input type="email" id="email" placeholder="E-posta" style="width:100%;padding:8px;margin-bottom:10px;">
        <input type="password" id="password" placeholder="Şifre" style="width:100%;padding:8px;margin-bottom:10px;">
        <button id="register-btn">Kayıt Ol ve Giriş Yap</button>
    </div>
    <div id="quiz-area" class="hidden"></div>
    <div class="score hidden" id="score-area">Puanınız: <span id="score">0</span></div>
</div>
<script>
let questions = [];
let current = 0;
let score = 0;
let user = null;

const loginArea = document.getElementById('login-area');
const quizArea = document.getElementById('quiz-area');
const scoreArea = document.getElementById('score-area');
const scoreSpan = document.getElementById('score');
const loginError = document.getElementById('login-error');

document.getElementById('register-btn').onclick = async function() {
    const username = document.getElementById('username').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    if (!username || !email || !password) {
        loginError.textContent = 'Lütfen tüm alanları doldurun!';
        return;
    }
    loginError.textContent = '';
    // Kayıt isteği
    const res = await fetch('/users/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, email, password })
    });
    if (res.ok) {
        user = await res.json();
        loginArea.classList.add('hidden');
        scoreArea.classList.remove('hidden');
        quizArea.classList.remove('hidden');
        score = 0;
        scoreSpan.textContent = score;
        showWelcome();
    } else {
        const err = await res.text();
        loginError.textContent = 'Kayıt/Giriş başarısız: ' + err;
    }
};

function showWelcome() {
    quizArea.innerHTML = `<div>Hoş geldiniz, <b>${user.username}</b>!<br><br><button id="start-btn">Yarışmaya Başla</button></div>`;
    document.getElementById('start-btn').onclick = function(e) {
        e.preventDefault();
        loadQuestions();
    };
}

async function loadQuestions() {
    quizArea.innerHTML = 'Sorular yükleniyor...';
    const res = await fetch('/game/questions');
    questions = await res.json();
    current = 0;
    score = 0;
    scoreSpan.textContent = score;
    showQuestion();
}

function showQuestion() {
    if (current >= questions.length) {
        quizArea.innerHTML = `<h3>Oyun Bitti!</h3><p>Toplam Puanınız: <b>${score}</b></p>`;
        return;
    }
    const q = questions[current];
    quizArea.innerHTML = `
        <div class="question">${current+1}. ${q.questionText}</div>
        <div class="options">
            <label><input type="radio" name="option" value="A"> ${q.optionA}</label>
            <label><input type="radio" name="option" value="B"> ${q.optionB}</label>
            <label><input type="radio" name="option" value="C"> ${q.optionC}</label>
            <label><input type="radio" name="option" value="D"> ${q.optionD}</label>
        </div>
        <button id="answer-btn">Cevabı Gönder</button>
        <div id="result"></div>
    `;
    document.getElementById('answer-btn').onclick = async function() {
        const selected = document.querySelector('input[name="option"]:checked');
        if (!selected) {
            document.getElementById('result').textContent = 'Lütfen bir seçenek seçin!';
            return;
        }
        const answer = selected.value;
        const res = await fetch('/game/answer', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ questionId: q.id, answer })
        });
        const data = await res.json();
        if (data.correct) {
            score += 10;
            scoreSpan.textContent = score;
            document.getElementById('result').textContent = 'Doğru! +10 puan';
        } else {
            document.getElementById('result').textContent = 'Yanlış!';
        }
        setTimeout(() => {
            current++;
            showQuestion();
        }, 1000);
    };
}
</script>
</body>
</html> 